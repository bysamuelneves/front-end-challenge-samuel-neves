<style>
    .container-conteudo {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        div.header {
            text-align: center;
            margin-bottom: 3rem;
        }
        div.header > h2 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        div.header > p {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 1rem;
        }
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 3rem;
        }
        .post-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background-color: #ecf0f1;
        }
        .no-image {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ecf0f1;
            color: #7f8c8d;
            font-size: 0.9rem;
            height: 200px;
        }
        .post-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .post-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2c3e50;
            line-height: 1.4;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .post-excerpt {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
            margin-bottom: 1.5rem;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .read-more-btn {
            display: inline-block;
            background: linear-gradient(90deg, #ed7606 0%, #fc9614 100%);
            color: white;
            text-decoration: none;
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(234, 185, 102, 0.3);
            text-align: center;
            align-self: flex-start;
        }
        .read-more-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(234, 185, 102, 0.5);
            color: white;
        }
        .loading {
            text-align: center;
            margin: 2rem 0;
        }
        .loading.show {
            display: block;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin: 1rem 0;
            display: none;
        }
        .error-message.show {
            display: block;
        }
        .retry-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .retry-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        .no-results {
            text-align: center;
            color: #666;
            grid-column: 1 / -1;
            font-size: 1.1rem;
            margin: 2rem 0;
        }
        .success-message {
            text-align: center;
            background: #2ecc71;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 2rem 0;
            display: none;
        }
        .success-message.show {
            display: block;
        }
        @media (max-width: 768px) {
            .posts-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            div.header > h2 {
                font-size: 2rem;
            }
            .container-conteudo {
                padding: 1rem;
            }
        }
</style>


<section class="loop-listing-grid">
    <div class="container-conteudo">
        <div class="header">
            <h2>Resultados da Pesquisa</h2>
            <p>Postagens encontradas para sua busca</p>
        </div>
        <div id="posts-container" class="posts-grid"></div>
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Carregando postagens...</p>
        </div>
        <div class="error-message" id="error-message">
            <p>Erro ao carregar as postagens. Tente novamente.</p>
            <button id="retry-btn" class="retry-btn">Tentar novamente</button>
        </div>
        <div class="success-message" id="success-message">
            Todos os resultados referentes Ã  pesquisa foram carregados!
        </div>
    </div>
</section>

<script>
    class ApikiSearchLoader {
            constructor() {
                this.container = document.getElementById('posts-container');
                this.loading = document.getElementById('loading');
                this.errorMessage = document.getElementById('error-message');
                this.retryBtn = document.getElementById('retry-btn');
                this.successMessage = document.getElementById('success-message');
                this.CATEGORY = 518;
                this.isLoading = false;
                this.container.innerHTML = '';
                this.init();
            }

            init() {
                const newRetryBtn = this.retryBtn.cloneNode(true);
                this.retryBtn.parentNode.replaceChild(newRetryBtn, this.retryBtn);
                this.retryBtn = newRetryBtn;
                this.retryBtn.addEventListener('click', () => this.retryLoad());
                this.loadPosts();
            }

            async loadPosts() {
                if (this.isLoading) return;
                this.isLoading = true;
                this.showLoading();
                this.hideError();
                this.hideSuccess();

                const urlParams = new URLSearchParams(window.location.search);
                const searchQuery = urlParams.get('s') || '';
                const apiUrl = `https://blog.apiki.com/wp-json/wp/v2/posts?_embed&categories=${this.CATEGORY}&search=${encodeURIComponent(searchQuery)}&per_page=10`;

                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                    const posts = await response.json();
                    this.renderPosts(posts);
                    this.hideLoading(); // Hide loading when data is ready
                    this.showSuccess();
                } catch (error) {
                    console.error('Erro ao carregar posts:', error);
                    this.showError();
                    this.hideLoading(); // Hide loading on error
                }
            }

            retryLoad() {
                this.hideError();
                this.loadPosts();
            }

            renderPosts(posts) {
                this.container.innerHTML = '';
                if (posts.length === 0) {
                    const noResults = document.createElement('p');
                    noResults.className = 'no-results';
                    noResults.textContent = `Nenhum resultado encontrado para "${new URLSearchParams(window.location.search).get('s') || ''}".`;
                    this.container.appendChild(noResults);
                    return;
                }

                posts.forEach(post => {
                    const card = this.createPostCard(post);
                    this.container.appendChild(card);
                });
            }

            createPostCard(post) {
                const card = document.createElement('div');
                card.className = 'post-card';
                card.setAttribute('data-post-id', post.id);

                const featuredMedia = post._embedded?.['wp:featuredmedia']?.[0];
                const imageUrl = featuredMedia?.source_url;
                const imageAlt = featuredMedia?.alt_text || post.title.rendered;

                const imageElement = imageUrl
                    ? `<img src="${imageUrl}" alt="${this.escapeHtml(imageAlt)}" class="post-image" loading="lazy">`
                    : `<div class="post-image no-image">Sem imagem</div>`;

                const excerpt = this.stripHtmlTags(post.excerpt.rendered);
                const customUrl = `https://samuelneves.com.br/desafio-apiki/artigo/?slug=${post.slug}`;

                card.innerHTML = `
                    ${imageElement}
                    <div class="post-content">
                        <h3 class="post-title">${post.title.rendered}</h3>
                        <p class="post-excerpt">${excerpt}</p>
                        <a href="${customUrl}" target="_blank" rel="noopener noreferrer" class="read-more-btn">Leia mais...</a>
                    </div>
                `;

                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                requestAnimationFrame(() => {
                    card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    requestAnimationFrame(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    });
                });

                return card;
            }

            showLoading() {
                this.loading.classList.add('show');
            }

            hideLoading() {
                this.loading.classList.remove('show');
            }

            showError() {
                this.errorMessage.classList.add('show');
            }

            hideError() {
                this.errorMessage.classList.remove('show');
            }

            showSuccess() {
                this.successMessage.classList.add('show');
            }

            hideSuccess() {
                this.successMessage.classList.remove('show');
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            stripHtmlTags(html) {
                const div = document.createElement('div');
                div.innerHTML = html;
                return div.textContent || div.innerText || '';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (window.apikiSearchLoader) {
                console.log('Reinicializando ApikiSearchLoader...');
                window.apikiSearchLoader = null;
            }
            window.apikiSearchLoader = new ApikiSearchLoader();
            console.log('ApikiSearchLoader inicializado com sucesso');
        });
</script>